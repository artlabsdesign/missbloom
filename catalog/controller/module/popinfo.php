<?php  class ControllerModulePopInfo extends Controller{ protected function index($setting){static $module=0;$this->language->load('module/popinfo');$this->load->model('tool/image');$this->load->model('catalog/product');$this->document->addStyle('catalog/view/theme/'.$this->config->get('config_template').'/stylesheet/popinfo.css');$show_module=true;$this->data['need_count']=false;if($setting['display_times']){$ip=$this->request->server['REMOTE_ADDR'];$this->data['need_count']=true;if(isset($this->session->data['popinfo_visitors'])){if(in_array($ip,$this->session->data['popinfo_visitors'])){$show_module=false;}}}$this->data['text_more']=$this->language->get('text_more');$this->data['text_promo_offer']=$this->language->get('text_promo_offer');if($setting['message_type']=="random_special"||$setting['message_type']=="choose_product"){$product_info=$this->load->model_catalog_product->getProduct($setting['featured_product']);$this->data['name']=html_entity_decode($product_info['name'],ENT_QUOTES,'UTF-8');if($product_info['image']){$this->data['image']=$this->model_tool_image->resize($product_info['image'],50,50);$this->data['product_data_class']='with-image';}else {$this->data['image']=false;$this->data['product_data_class']='';}if(($this->config->get('config_customer_price')&&$this->customer->isLogged())||!$this->config->get('config_customer_price')){$this->data['price']=$this->currency->format($this->tax->calculate($product_info['price'],$product_info['tax_class_id'],$this->config->get('config_tax')));}else {$this->data['price']=false;}if((float)$product_info['special']){$this->data['special']=$this->currency->format($this->tax->calculate($product_info['special'],$product_info['tax_class_id'],$this->config->get('config_tax')));}else {$this->data['special']=false;}$this->data['description']=mb_substr(strip_tags(html_entity_decode($product_info['description'],ENT_QUOTES,'UTF-8')),0,100).'..';$this->data['link']=$this->url->link('product/product','product_id='.$product_info['product_id'],'SSL');}$this->data['importance']='normal';$this->data['sound']=$setting['sound'];if($setting['message_type']=="define_myself"){if(isset($setting['description'][$this->config->get('config_language_id')])){if($setting['importance']=="high"){$this->data['message']=html_entity_decode($setting['description'][$this->config->get('config_language_id')],ENT_QUOTES,'UTF-8');$this->data['importance']='high';}else {$this->data['message']=mb_substr(strip_tags(html_entity_decode($setting['description'][$this->config->get('config_language_id')],ENT_QUOTES,'UTF-8')),0,200).'..';}}else {$this->data['message']='';}$this->data['link']=$setting['link'];}$this->data['module']=$module++;if($setting['message_type']=="define_myself"){$template_file="popinfo_dm.tpl";}else {$template_file="popinfo_product.tpl";}if(file_exists(DIR_TEMPLATE.$this->config->get('config_template').'/template/module/'.$template_file)){$this->template=$this->config->get('config_template').'/template/module/'.$template_file;}else {$this->template='default/template/module/'.$template_file;}if($show_module){$this->render();}} public function countclose(){$ip=$this->request->server['REMOTE_ADDR'];$this->session->data['popinfo_visitors'][]=$ip;}}?>